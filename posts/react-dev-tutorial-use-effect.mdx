---
title: react.dev íŠœí† ë¦¬ì–¼ ë©”ëª¨ useEffect íŒŒíŠ¸
date: 2023-09-20
description: useEffectê°€ íŠ¹íˆ ì¤‘ìš”í•˜ì—¬ ë³„ë„ë¡œ ì œì‘í•©ë‹ˆë‹¤ ğŸ˜Š
thumbnail: /images/posts/react-dev-tutorial-use-effect/intro.png
tags:
  - React
---

ğŸ’¡ useEffectëŠ” ì‚¬ë¡€ë¡œ ë°°ìš°ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ê¸° ë•Œë¬¸ì—, ê³µì‹ë¬¸ì„œ ì •ë¦¬ ë’¤ì— Overreacted ê¸€ ë‚´ìš©ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.

- [React, Effectë¡œ ë™ê¸°í™”í•˜ê¸°](https://ko.react.dev/learn/synchronizing-with-effects) ~ [Effectì˜ ì˜ì¡´ì„± ì œê±°í•˜ê¸°](https://ko.react.dev/learn/removing-effect-dependencies)
- [Overreacted, useEffect ì™„ë²½ ê°€ì´ë“œ](https://overreacted.io/ko/a-complete-guide-to-useeffect/)

# Effectë¡œ ë™ê¸°í™”í•˜ê¸°

## ì»´í¬ë„ŒíŠ¸ì˜ 3ê°€ì§€ ë¡œì§ ìœ í˜•

| ìœ í˜•                                   | ìˆœìˆ˜ í•¨ìˆ˜ | íŠ¸ë¦¬ê±°        |
| -------------------------------------- | --------- | ------------- |
| ë Œë”ë§ ì½”ë“œ (props, state, return JSX) | O         | ë Œë”ë§        |
| ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬                          | X         | ì‚¬ìš©ìì˜ í–‰ìœ„ |
| Effect                                 | X         | ë Œë”ë§        |

ìˆœìˆ˜ í•¨ìˆ˜ì˜ ì¡°ê±´

1. ê°™ì€ ì…ë ¥ì´ ì£¼ì–´ì¡Œë‹¤ë©´, ê°™ì€ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤. (ì™¸ë¶€ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆ ëœë‹¤)
2. í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ê¸° ì „ì— ì¡´ì¬í–ˆë˜ ê°ì²´ë‚˜ ë³€ìˆ˜ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ë‹¤. (ì™¸ë¶€ ë³€ìˆ˜ë¥¼ ë³€ê²½í•˜ë©´ ì•ˆ ëœë‹¤)

![why does react care about purity](/images/posts/react-dev-tutorial-use-effect/why-does-react-care-about-purity-capture.png)

ì¦‰, ì™¸ë¶€ì˜ ìƒíƒœë¥¼ ë³€ê²½í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ìˆœìˆ˜í•˜ì§„ ì•Šì§€ë§Œ, ì‚¬ìš©ìì˜ í–‰ìœ„ë¡œ íŠ¸ë¦¬ê±°ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê·¸ì € ë Œë”ë§ë˜ê¸° ë•Œë¬¸ì— íŠ¸ë¦¬ê±°ë˜ì–´ì•¼ í•˜ëŠ” í–‰ìœ„ë¥¼ **Effect**ë¼ê³  í•œë‹¤. í”„ë¡œê·¸ë˜ë° ê°œë… Side effect (ë¶€ìˆ˜ íš¨ê³¼)ë¥¼ Reactì—ì„œëŠ” Effectë¼ê³  ë¶€ë¥¸ë‹¤.

ë Œë”ë§ê³¼ Effectë¥¼ í™•ì‹¤íˆ ë¶„ë¦¬í•˜ê¸° ìœ„í•˜ì—¬ `useEffect`ê°€ ê³ ì•ˆë˜ì—ˆìœ¼ë©°, **ë Œë”ë§ì´ ì™„ë£Œëœ ì´í›„** ë³„ë„ë¡œ ì‹¤í–‰ëœë‹¤.

## Side effectì˜ ì˜ˆì‹œ

- í•¨ìˆ˜ ì™¸ë¶€ì˜ ì „ì—­ ë³€ìˆ˜ ë³€ê²½
- AJAX
  - BE APIì— ë„¤íŠ¸ì›Œí¬ ìš”ì²­
- Web API ì‚¬ìš©
  - íŒŒì¼, web storage, ì¿ í‚¤ì— ì ‘ê·¼
  - document, window ê°ì²´ì— ì ‘ê·¼
  - setTimeout, setInterval
  - ì—„ë°€íˆ ë§í•˜ë©´, console.logë„ ì™¸ë¶€ ì½˜ì†” ìƒíƒœë¥¼ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ side effectë‹¤.

ex. ì±„íŒ… ì„œë²„ì— ì ‘ì†

```tsx
export default function ChatRoom() {
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, []);
  return <h1>ì±„íŒ…ì— ì˜¤ì‹ ê±¸ í™˜ì˜í•©ë‹ˆë‹¤!</h1>;
}
```

ex. DOM ë…¸ë“œ ì¡°ì‘

useRefë¥¼ ì´ìš©í•˜ì—¬ DOM ë…¸ë“œë¥¼ ì¡°ì‘í•˜ëŠ” í–‰ìœ„ëŠ” ìˆœìˆ˜í•˜ì§€ ì•Šì„ ë¿ë”ëŸ¬ ë Œë”ë§ ì¤‘ì— ì‹¤í–‰í•˜ë©´ `null`ì´ë¼ì„œ ì—ëŸ¬ê°€ ë‚œë‹¤. ë°˜ë©´, useEffectëŠ” ë Œë”ë§ì´ ëë‚œ ì´í›„ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— refì— DOM ë…¸ë“œê°€ ë°”ì¸ë”©ë˜ì—ˆë‹¤ê³  ê°€ì •í•  ìˆ˜ ìˆë‹¤.

```tsx
function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      console.log('video.play() í˜¸ì¶œ');
      ref.current.play();
    } else {
      console.log('video.pause() í˜¸ì¶œ');
      ref.current.pause();
    }
  }, [isPlaying]);

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  const [text, setText] = useState('');
  return (
    <>
      <input value={text} onChange={(e) => setText(e.target.value)} />
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'ì¼ì‹œ ì •ì§€' : 'ì¬ìƒ'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

> Effectê°€ í•„ìš” ì—†ì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤. **ì»´í¬ë„ŒíŠ¸ì— Effectë¥¼ ë¬´ì‘ì • ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.** EffectëŠ” ì£¼ë¡œ React ì½”ë“œë¥¼ ë²—ì–´ë‚œ íŠ¹ì • _ì™¸ë¶€_ ì‹œìŠ¤í…œê³¼ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ëŠ” ë¸Œë¼ìš°ì € API, ì¨ë“œíŒŒí‹° ìœ„ì ¯, ë„¤íŠ¸ì›Œí¬ ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤. ë§Œì•½ ë‹¹ì‹ ì˜ Effectê°€ ë‹¨ìˆœíˆ ë‹¤ë¥¸ ìƒíƒœì— ê¸°ë°˜í•˜ì—¬ ì¼ë¶€ ìƒíƒœë¥¼ ì¡°ì •í•˜ëŠ” ê²½ìš°ì—ëŠ” [Effectê°€ í•„ìš”í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.](https://ko.react.dev/learn/you-might-not-need-an-effect)

ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì™€ useEffect ëª¨ë‘ ìˆœìˆ˜í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ì´ ë‘˜ì„ í˜¼ë™í•˜ì—¬ **ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ìƒíƒœ ë³€ê²½ â†’ í•´ë‹¹ ìƒíƒœë¥¼ ì˜ì¡´ì„± ë°°ì—´ì— ë‹´ì€ useEffectì—ì„œ ë‚˜ë¨¸ì§€ ë‹¨ê³„ ì‹¤í–‰**í•˜ëŠ” ë¡œì§ì„ ì¢…ì¢… ì§œëŠ” ê±¸ ë³¼ ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” ëª…ë°±í•œ ì•ˆí‹°íŒ¨í„´ì´ë‹¤. ì„¤ë ¹ ì—¬ëŸ¬ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ê²¹ì¹˜ëŠ” ë¡œì§ì´ ìˆë‹¤ í•˜ë”ë¼ë„, ê° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ëª¨ë‘ í˜¸ì¶œí•´ì£¼ëŠ” ê²ƒì´ ì˜³ë‹¤.

[Effectê°€ í•„ìš”í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤ â€“ React](https://ko.react.dev/learn/you-might-not-need-an-effect#sharing-logic-between-event-handlers)

## ì•ˆì •ëœ ì‹ë³„ì„±(stable identity)

**ì•ˆì •ëœ ì‹ë³„ì„±**ì´ë€ í•­ìƒ ê°™ì€ ê°ì²´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒì„ ë³´ì¥í•œë‹¤ëŠ” ëœ»ì´ë©°, ì•ˆì •ëœ ì‹ë³„ì„±ì„ ê°–ëŠ” ê²½ìš° ì˜ì¡´ì„± ë°°ì—´ì— í¬í•¨í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

ex. useRefì˜ ë°˜í™˜ê°’(ref), useStateì˜ setter, useReducerì˜ dispatch

í•˜ì§€ë§Œ, **ë¶€ëª¨ë¡œë¶€í„° propìœ¼ë¡œ ì „ë‹¬ë°›ì€ refì˜ ê²½ìš° íƒ€ì…ì€ ê°™ì§€ë§Œ ë‹¤ë¥¸ ê°ì²´ê°€ ë“¤ì–´ì˜¬ ê°€ëŠ¥ì„±ë„ ìˆê¸° ë•Œë¬¸ì—** ë§Œì•½ í•´ë‹¹ refë¥¼ useEffect ë‚´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” refë„ ì˜ì¡´ì„± ë°°ì—´ì— ë„£ì–´ì•¼ í•œë‹¤.

## Effectê°€ ë‘ ë²ˆ ì‹¤í–‰ë˜ëŠ” ê²½ìš°

React.StrictModeì—ì„œ **mount â†’ unmount â†’ mount** í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ì˜ ìˆœìˆ˜ì„±ì„ íŒŒì•…í•˜ê¸° ë•Œë¬¸ì´ë©°, â€œ**Effectë¥¼ í•œ ë²ˆ ì‹¤í–‰í•˜ëŠ” ë°©ë²•â€ì´ ì•„ë‹ˆë¼ â€œì–´ë–»ê²Œ Effectê°€ ë‹¤ì‹œ ë§ˆìš´íŠ¸ëœ í›„ì—ë„ ì‘ë™í•˜ë„ë¡ ê³ ì¹  ê²ƒì¸ê°€â€ë¼ëŠ” ê²ƒì´ ì˜³ì€ ì§ˆë¬¸ì´ë‹¤.**

> ë‹¹ì—°í•œ ì–˜ê¸°ê² ì§€ë§Œ, cleanup í•¨ìˆ˜ëŠ” ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œì—ë§Œ ì‹¤í–‰ë˜ëŠ” ê²Œ ì•„ë‹ˆë¼ **ì˜ì¡´ì„± ë°°ì—´ ê°’ì´ ìˆ˜ì •ë˜ì–´ ë‹¤ì‹œ Effect í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ì˜¤ë©´, ê·¸ ì „ì—ë„ cleanup í•¨ìˆ˜ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.**
>
> useEffectë¥¼ í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ì˜ ë¼ì´í”„ì‚¬ì´í´ì— ëŒ€ì‘í•´ì„œ ë³´ëŠ” ì§“ì„ ê·¸ë§Œë‘ì„¸ìš”! ì´ì œëŠ” Effect ê¸°ì¤€ìœ¼ë¡œ ìƒê°í•´ì•¼ í•©ë‹ˆë‹¤. useEffectëŠ” ë§ˆìš´íŠ¸ ì‹œì—**ë„** ì‹¤í–‰ë˜ê³ , cleanup í•¨ìˆ˜ëŠ” ì–¸ë§ˆìš´íŠ¸ ì‹œì—**ë„** ì‹¤í–‰ë  ë¿ì…ë‹ˆë‹¤.

ex. ë‘ ë²ˆ ë§ˆìš´íŠ¸ë˜ì–´ë„ ê°™ì€ setì„ ë‘ ë²ˆ í•˜ëŠ” ê±°ë¼ ë¬¸ì œ ì—†ë‹¤.

```tsx
useEffect(() => {
  const map = mapRef.current;
  map.setZoomLevel(zoomLevel);
}, [zoomLevel]);
```

ex. ë‘ ë²ˆ ë§ˆìš´íŠ¸ë˜ë©´ ë‹¤ì´ì–¼ë¡œê·¸ê°€ ë‘ ê°œ ëœ¬ë‹¤.

```tsx
useEffect(() => {
  const dialog = dialogRef.current;
  dialog.showModal();

  // return () => dialog.close();
}, []);
```

ex. ë‘ ë²ˆ ë§ˆìš´íŠ¸ë˜ë©´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ë‘ ê°œ ë¶™ëŠ”ë‹¤.

```tsx
useEffect(() => {
  function handleScroll(e) {
    console.log(window.scrollX, window.scrollY);
  }
  window.addEventListener('scroll', handleScroll);

  // return () => window.removeEventListener('scroll', handleScroll);
}, []);
```

ex. ì–¸ë§ˆìš´íŠ¸ë  ë•Œ ì• ë‹ˆë©”ì´ì…˜ì´ ë˜ëŒì•„ê°€ì§€ ì•ŠëŠ”ë‹¤.

```tsx
useEffect(() => {
  const node = ref.current;
  node.style.opacity = 1; // Trigger the animation

  // return () => {
  //   node.style.opacity = 0; // Reset to the initial value
  // };
}, []);
```

ex. ë‘ ë²ˆ ë§ˆìš´íŠ¸ë˜ë©´ ë°©ë¬¸ ë¡œê·¸ê°€ ë‘ ë²ˆ ë³´ë‚´ì§„ë‹¤.

```tsx
useEffect(() => {
  logVisit(url); // POST ìš”ì²­ì„ ë³´ëƒ„
}, [url]);
```

**ìš°ë¦¬ëŠ” ì´ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.** â‘  ê°œë°œ í™˜ê²½ì—ì„œëŠ” `logVisit`ê°€ ì•„ë¬´ ì‘ì—…ë„ ìˆ˜í–‰í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ê°œë°œ í™˜ê²½ì˜ ë¡œê·¸ê°€ ì œí’ˆ ì§€í‘œë¥¼ ì™œê³¡ì‹œí‚¤ì§€ ì•Šë„ë¡ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. **â‘¡ ì œí’ˆ í™˜ê²½ì—ì„œëŠ” ì¤‘ë³µëœ ë°©ë¬¸ ë¡œê·¸ê°€ ì—†ì„ ê²ƒì…ë‹ˆë‹¤.**

ë³´ë‚´ëŠ” ë¶„ì„ ì´ë²¤íŠ¸ë¥¼ ë””ë²„ê¹…í•˜ë ¤ë©´ ì•±ì„ ìŠ¤í…Œì´ì§• í™˜ê²½(ì œí’ˆ ëª¨ë“œë¡œ ì‹¤í–‰)ì— ë°°í¬í•˜ê±°ë‚˜ [Strict Mode](https://ko.react.dev/reference/react/StrictMode)ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš© ì¤‘ì§€í•˜ì—¬ ê°œë°œ í™˜ê²½ ì „ìš©ì˜ ì¬ë§ˆìš´íŒ… ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ Effect ëŒ€ì‹  ë¼ìš°íŠ¸ ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ë¶„ì„ì„ ë³´ë‚¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë” ì •ë°€í•œ ë¶„ì„ì„ ìœ„í•´ [Intersection Observer](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ê°€ ë·°í¬íŠ¸ì— ìˆëŠ”ì§€ì™€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ë³´ì´ëŠ”ì§€ ì¶”ì í•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ex. ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ì´ ì•„ë‹ˆë¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°

Case 1. ì•± ë¡œë“œ ì´í›„

```tsx
let didInit = false;

function App() {
  useEffect(() => {
    if (!didInit) {
      didInit = true;
      // âœ… ì•± ë¡œë“œë‹¹ í•œ ë²ˆë§Œ ì‹¤í–‰
      loadDataFromLocalStorage();
      checkAuthToken();
    }
  }, []);
  // ...
}
```

Case 2. ì•± ë Œë”ë§ ì´ì „

```tsx
if (typeof window !== 'undefined') {
  // ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
  checkAuthToken();
  loadDataFromLocalStorage();
}

function App() {
  // ...
}
```

## useEffect ë‚´ì—ì„œì˜ fetch ê²½ìŸ ìƒíƒœ

[Effectë¡œ ë™ê¸°í™”í•˜ê¸° - ì±Œë¦°ì§€ 4ë²ˆ ë§í¬](https://ko.react.dev/learn/synchronizing-with-effects#fix-fetching-inside-an-effect)

```tsx
import { useState, useEffect } from 'react';
import { fetchBio } from './api.js';

export default function Page() {
  const [person, setPerson] = useState('Alice');
  const [bio, setBio] = useState(null);

  useEffect(() => {
    setBio(null);
    fetchBio(person).then((result) => {
      setBio(result);
    });
  }, [person]);

  return (
    <>
      <select
        value={person}
        onChange={(e) => {
          setPerson(e.target.value);
        }}
      >
        <option value="Alice">Alice</option>
        <option value="Bob">Bob</option>
        <option value="Taylor">Taylor</option>
      </select>
      <hr />
      <p>
        <i>{bio ?? 'Loading...'}</i>
      </p>
    </>
  );
}
```

Bobì— ëŒ€í•œ ìš”ì²­ì€ ì˜¤ë˜ ê±¸ë¦¬ê³ , Taylorì— ëŒ€í•œ ìš”ì²­ì€ ë¹ ë¥´ë‹¤ê³  ê°€ì •í•´ë³´ì.

Bobì„ ì„ íƒí–ˆë‹¤ê°€ ë¡œë”©ì´ ëë‚˜ê¸° ì „ì— Taylorë¡œ ë°”ê¾¼ë‹¤ë©´, Taylor ì •ë³´ë¡œ `setBio`ê°€ ì´ë£¨ì–´ì§„ ë’¤, Bob ì •ë³´ê°€ ë„ì°©í•˜ë©´ Bob ì •ë³´ë¡œ ë®ì–´ì”Œì›Œì§€ëŠ” ë²„ê·¸ê°€ ë°œìƒí•œë‹¤.

ì´ë¥¼ ê²½ìŸ ìƒíƒœë¼ê³  í•˜ë©°, **ê°ê°ì˜ ë Œë”ë§ì€ ê°ê°ì˜ ê³ ìœ í•œ Effect(ë‹¤ë¥¸ Effectì™€ êµ¬ë³„ë˜ëŠ” í´ë¡œì €)ë¥¼ ê°€ì§€ê¸° ë•Œë¬¸ì—** Bobì˜ í”„ë¡œë¯¸ìŠ¤ê°€ ì—¬ì „íˆ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” cleanup í•¨ìˆ˜ì—ì„œ í”„ë¡œë¯¸ìŠ¤ê°€ ëŒì•„ì™€ë„ ê²°ê³¼ë¥¼ ë°˜ì˜í•˜ì§€ ì•Šë„ë¡ `ignore` í”Œë˜ê·¸ë¥¼ ë³„ë„ë¡œ ë‘ì–´ì•¼ í•œë‹¤.

```tsx
useEffect(() => {
  let ignore = false;
  setBio(null);
  fetchBio(person).then((result) => {
    if (!ignore) {
      setBio(result);
    }
  });

  return () => {
    ignore = true;
  };
}, [person]);
```

ë³´ì¶© ì„¤ëª…. í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ ì‹œì ˆê³¼ì˜ ë™ì‘ ì°¨ì´

[useEffect ì™„ë²½ ê°€ì´ë“œ](https://overreacted.io/ko/a-complete-guide-to-useeffect/#ëª¨ë“ -ëœë”ë§ì€-ê³ ìœ ì˜-ëª¨ë“ -ê²ƒì„-ê°€ì§€ê³ -ìˆë‹¤)

ë‹¤ìŒê³¼ ê°™ì´ hookì„ ë§Œë“œëŠ” ë°©ë²•ë„ ìˆë‹¤.

```tsx
function SearchResults({ query }) {
  const [page, setPage] = useState(1);
  const params = new URLSearchParams({ query, page });
  const results = useData(`/api/search?${params}`);

  function handleNextPageClick() {
    setPage(page + 1);
  }
  // ...
}

function useData(url) {
  const [data, setData] = useState(null);
  useEffect(() => {
    let ignore = false;
    fetch(url)
      .then((response) => response.json())
      .then((json) => {
        if (!ignore) {
          setData(json);
        }
      });
    return () => {
      ignore = true;
    };
  }, [url]);
  return data;
}
```

![Resolve fetch in useEffect ìº¡ì²˜ 1](/images/posts/react-dev-tutorial-use-effect/resolve-fetch-in-use-effect-1.png)

![Resolve fetch in useEffect ìº¡ì²˜ 2](/images/posts/react-dev-tutorial-use-effect/resolve-fetch-in-use-effect-2.png)

# Effectê°€ í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš°

ex. íŒŒìƒ ìƒíƒœ

```tsx
function Form() {
  const [firstName, setFirstName] = useState('Taylor');
  const [lastName, setLastName] = useState('Swift');

  // ğŸ”´ í”¼í•˜ì„¸ìš”: ì¤‘ë³µëœ state ë° ë¶ˆí•„ìš”í•œ Effect
  const [fullName, setFullName] = useState('');
  useEffect(() => {
    setFullName(firstName + ' ' + lastName);
  }, [firstName, lastName]);

  // âœ… ì¢‹ìŠµë‹ˆë‹¤: ë Œë”ë§ ì¤‘ì— ê³„ì‚°ë¨
  const fullName = firstName + ' ' + lastName;
  // ...
}
```

ex. filtered list

```tsx
function TodoList({ todos, filter }) {
  const [newTodo, setNewTodo] = useState('');

  // ğŸ”´ í”¼í•˜ì„¸ìš”: ì¤‘ë³µëœ state ë° ë¶ˆí•„ìš”í•œ íš¨ê³¼
  const [visibleTodos, setVisibleTodos] = useState([]);
  useEffect(() => {
    setVisibleTodos(getFilteredTodos(todos, filter));
  }, [todos, filter]);

  // âœ… getFilteredTodos()ê°€ ëŠë¦¬ì§€ ì•Šë‹¤ë©´ ê´œì°®ìŠµë‹ˆë‹¤.
  console.time('filter array');
  const visibleTodos = getFilteredTodos(todos, filter);
  console.timeEnd('filter array');

  // âœ… getFilteredTodos()ê°€ ë¹„ì‹¸ë‹¤ë©´ useMemoë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  const visibleTodos = useMemo(
    () => getFilteredTodos(todos, filter),
    [todos, filter],
  );
  // ...
}
```

ex. propì´ ë³€ê²½ë  ë•Œ ëª¨ë“  state ì´ˆê¸°í™”

```tsx
export default function ProfilePage({ userId }) {
  // âœ… Profileì˜ ëª¨ë“  stateëŠ” key ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì¬ì„¤ì •ë©ë‹ˆë‹¤.
  return <Profile userId={userId} key={userId} />;
}

function Profile({ userId }) {
  const [comment, setComment] = useState('');

  // ğŸ”´ í”¼í•˜ì„¸ìš”: Effectì—ì„œ prop ë³€ê²½ ì‹œ state ì´ˆê¸°í™”
  useEffect(() => {
    setComment('');
  }, [userId]);
  // ...
}
```

ex. propì´ ë³€ê²½ë  ë•Œ ì¼ë¶€ state ì¡°ì •í•˜ê¸°

```tsx
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selection, setSelection] = useState(null);

  // ğŸ”´ í”¼í•˜ì„¸ìš”: Effectì—ì„œ prop ë³€ê²½ ì‹œ state ì¡°ì •í•˜ê¸°
  useEffect(() => {
    setSelection(null);
  }, [items]);

  // ë” ì¢‹ìŠµë‹ˆë‹¤: ë Œë”ë§ ì¤‘ state ì¡°ì •
  const [prevItems, setPrevItems] = useState(items);
  if (items !== prevItems) {
    setPrevItems(items);
    setSelection(null);
  }

  const [selectedId, setSelectedId] = useState(null);
  // âœ… ìµœê³ ì˜ˆìš”: ë Œë”ë§ ì¤‘ì— ëª¨ë“  ê²ƒì„ ê³„ì‚°
  const selection = items.find((item) => item.id === selectedId) ?? null;
  // ...
}
```

[ì´ì „ ë Œë”ë§ì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒ](https://ko.react.dev/reference/react/useState#storing-information-from-previous-renders)ì€ ì´í•´í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆì§€ë§Œ Effectì—ì„œ ë™ì¼í•œ stateë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒë³´ë‹¤ ë‚«ìŠµë‹ˆë‹¤. ìœ„ ì˜ˆì‹œì—ì„œëŠ” ë Œë”ë§ ë„ì¤‘ `setSelection`ì´ ì§ì ‘ í˜¸ì¶œë©ë‹ˆë‹¤. ReactëŠ” `return` ë¬¸ìœ¼ë¡œ ì¢…ë£Œëœ í›„ _ì¦‰ì‹œ_ `List`ë¥¼ ë‹¤ì‹œ ë Œë”ë§ í•©ë‹ˆë‹¤. ReactëŠ” ì•„ì§ `List` ìì‹ì„ ë Œë”ë§ í•˜ê±°ë‚˜ DOMì„ ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì˜¤ë˜ëœ `selection` ê°’ì˜ ë Œë”ë§ì„ ê±´ë„ˆë›¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì´ íŒ¨í„´ì´ Effectë³´ë‹¤ ë” íš¨ìœ¨ì ì´ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ì»´í¬ë„ŒíŠ¸ì—ëŠ” ì´ íŒ¨í„´ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.** ì–´ë–»ê²Œ í•˜ë“  propsë‚˜ ë‹¤ë¥¸ stateì— ë”°ë¼ stateë¥¼ ì¡°ì •í•˜ë©´ ë°ì´í„° íë¦„ì„ ì´í•´í•˜ê³  ë””ë²„ê¹…í•˜ê¸°ê°€ ë” ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤.

- useSyncExternalStore ì•Œì•„ë³´ê¸°

# Effectì—ì„œ ì´ë²¤íŠ¸ ë¶„ë¦¬í•˜ê¸°

`useEffectEvent`ê°€ Reactì˜ ì•ˆì •ì ì¸ ê¸°ëŠ¥ì´ ë˜ë©´ **ë¦°í„°ë¥¼ ì ˆëŒ€ë¡œ ì–µì œ**(`eslint-disable-next-line react-hooks/exhaustive-deps`)**í•˜ì§€ ì•Šì„ ê²ƒ**ì„ ì¶”ì²œí•©ë‹ˆë‹¤.

â†’ í˜„ì¬ëŠ” ë¹„ë°˜ì‘í˜• ë¡œì§ì´ ìˆëŠ” ê²½ìš° **ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„±ì„ ì œê±°(ì•„ë˜ ì¥ì—ì„œ ì†Œê°œ)í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ ê¶ë¦¬**í•´ë³´ê³ , ë‹¤ ì•ˆ ëœë‹¤ë©´ ë¶ˆê°€í”¼í•˜ì§€ë§Œ ë¦°í„° ì–µì œë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

ex. chatRoom connect

```tsx
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId, theme }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      showNotification('ì—°ê²°ë¨!', theme);
    });
    connection.connect();
    return () => connection.disconnect();
    // theme ë³€ê²½ ì‹œì—ëŠ” reconnect í•˜ê³  ì‹¶ì§€ ì•Šì•„ë„ ì˜ì¡´ì„± ë°°ì—´ ê·œì¹™ì— ë”°ë¼ themeì„ ë„£ì–´ì•¼ í•œë‹¤ëŠ” ë¬¸ì œ.
  }, [roomId, theme]);

  return <h1>{roomId} ë°©ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h1>;
}
```

useEffectEventë¥¼ ë§Œì•½ ì‚¬ìš©í•œë‹¤ë©´, ë‹¤ìŒê³¼ ê°™ì´ theme ë¡œì§ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.

```tsx
function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification('ì—°ê²°ë¨!', theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      onConnected();
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  return <h1>{roomId} ë°©ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h1>;
}
```

âš ï¸ ì°¨ë¼ë¦¬ ì‹¤í—˜ì  ê¸°ëŠ¥ì¸ useEffectEventë¥¼ ì“°ê³ , ë¦°í„° ì–µì œ(`eslint-disable-next-line react-hooks/exhaustive-deps`)ëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ì.

# Effectì˜ ì˜ì¡´ì„± ì œê±°í•˜ê¸°

í•˜ì§€ë§Œ useEffectEventë¡œ ë¹¼ê¸° ì „ ë‹¤ìŒì˜ ê²½ìš°ê°€ ì•„ë‹Œì§€ ê³ ë ¤í•´ë³´ì.

ex. propì´ ìƒìˆ˜ì¸ ê²½ìš°, ì»´í¬ë„ŒíŠ¸ ë°”ê¹¥ìœ¼ë¡œ ë¹¼ê¸°

```tsx
function ChatRoom({ roomId }) {
  // ...
  const options = {
    serverUrl: serverUrl,
    roomId: roomId
  };

	useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [options]); // âœ… All dependencies declared
    // ...
```

```tsx
const options = {
  serverUrl: 'https://localhost:1234',
  roomId: 'music'
};

function ChatRoom() {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, []); // âœ… All dependencies declared
  // ...
```

```tsx
**function createOptions() {**
  return {
    serverUrl: 'https://localhost:1234',
    roomId: 'music'
  };
}

function ChatRoom() {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, []); // âœ… All dependencies declared
  // ...
```

**ì˜ì¡´ì„±ì„ ì œê±°í•˜ë ¤ë©´ ì˜ì¡´ì„±ì´ ì•„ë‹˜ì„ ì¦ëª…í•´ì•¼ í•œë‹¤.**

ì •ë§ propsê°€ ì•„ë‹ˆë¼ ìƒìˆ˜ë¼ë©´, ì»´í¬ë„ŒíŠ¸ ë°”ê¹¥ìœ¼ë¡œ ë¹¼ê±°ë‚˜ custom hookìœ¼ë¡œ ë§Œë“¤ì.

ì—­ìœ¼ë¡œ useEffect ë‚´ë¡œ ë³€ìˆ˜/í•¨ìˆ˜ë¥¼ ì˜®ê¸°ëŠ” ë°©ì‹ì„ ì´ìš©í•˜ì—¬ ì˜ì¡´ì„±ì´ ì•„ë‹˜ì„ ì¦ëª…í•  ìˆ˜ë„ ìˆë‹¤.

```tsx
function SearchResults() {
  const [query, setQuery] = useState('react');

  useEffect(() => {
    **function getFetchUrl() {**
      return 'https://hn.algolia.com/api/v1/search?query=' + query;
    }

    async function fetchData() {
      const result = await axios(getFetchUrl());
      setData(result.data);
    }

    fetchData();
  }, [query]); // âœ… DepsëŠ” OK
  // ...
}
```

ex. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì— ìˆì–´ì•¼ í•˜ëŠ” ë¡œì§ì„ Effectë¡œ ì“°ì§€ ë§ˆë¼

```tsx
function Form() {
  const [submitted, setSubmitted] = useState(false);

  useEffect(() => {
    if (submitted) {
      // ğŸ”´ Avoid: Event-specific logic inside an Effect
      post('/api/register');
      showNotification('Successfully registered!');
    }
  }, [submitted]);

  function handleSubmit() {
    setSubmitted(true);
  }

  // ...
}
```

```tsx
function Form() {
  const theme = useContext(ThemeContext);

  **function handleSubmit() {**
    // âœ… Good: Event-specific logic is called from event handlers
    post('/api/register');
    showNotification('Successfully registered!', theme);
  }

  // ...
}
```

ex. ë¶„ë¦¬ë˜ì–´ì•¼ í•˜ëŠ” Effect 2ê°œë¥¼ í•©ì¹˜ì§€ ë§ˆë¼

```tsx
function ShippingForm({ country }) {
  const [cities, setCities] = useState(null);
  useEffect(() => {
    let ignore = false;
    fetch(`/api/cities?country=${country}`)
      .then(response => response.json())
      .then(json => {
        if (!ignore) {
          setCities(json);
        }
      });
    return () => {
      ignore = true;
    };
  }, [country]); // âœ… All dependencies declared

  const [city, setCity] = useState(null);
  const [areas, setAreas] = useState(null);
  useEffect(() => {
    if (city) {
      let ignore = false;
      fetch(`/api/areas?city=${city}`)
        .then(response => response.json())
        .then(json => {
          if (!ignore) {
            setAreas(json);
          }
        });
      return () => {
        ignore = true;
      };
    }
  }, [city]); // âœ… All dependencies declared

  // ...
```

ex. setterë¥¼ í•¨ìˆ˜í˜•ìœ¼ë¡œ ë§Œë“¤ì–´ë¼.

```tsx
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages([...messages, receivedMessage]);
    });
    return () => connection.disconnect();
  }, [roomId, messages]); // âœ… All dependencies declared
  // ...
```

`messages`ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ë§Œë“¤ë©´ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.

ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•  ë•Œë§ˆë‹¤ `setMessages()`ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ìˆ˜ì‹ ëœ ë©”ì‹œì§€ë¥¼ í¬í•¨í•˜ëŠ” ìƒˆ `messages` ë°°ì—´ë¡œ ì¬ë Œë”ë§í•˜ë„ë¡ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ EffectëŠ” ì´ì œ `messages`ì— ë”°ë¼ ë‹¬ë¼ì§€ë¯€ë¡œ Effectë„ ë‹¤ì‹œ ë™ê¸°í™”ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ìƒˆ ë©”ì‹œì§€ê°€ ì˜¬ ë•Œë§ˆë‹¤ ì±„íŒ…ì´ ë‹¤ì‹œ ì—°ê²°ë©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì›í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤!

```tsx
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      **setMessages(msgs => [...msgs, receivedMessage]);**
    });
    return () => connection.disconnect();
  }, [roomId]); // âœ… All dependencies declared
  // ...
```

# Overreacted ë³´ì¶©

> Overreacted ì•„í‹°í´ì€ 2019ë…„ì— ì“°ì—¬ì¡Œìœ¼ë©°, ì—¬ê¸°ì„œ ë“±ì¥í•œ ì‚¬ë¡€ë“¤ì€ ëŒ€ë¶€ë¶„ React ê³µì‹ë¬¸ì„œì—ì„œë„ (ë” ê°€ë…ì„± ì¢‹ê²Œ) ì†Œê°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ ë‹¨ë½ì—ì„œëŠ” React ê³µì‹ë¬¸ì„œì—ì„œ ì†Œê°œí•˜ì§€ ì•Šì€ ì‚¬ë¡€ ìœ„ì£¼ë¡œ ì†Œê°œí•©ë‹ˆë‹¤.

## useReducerë¡œ ì˜ì¡´ì„± ì—†ì• ê¸°

```tsx
function Counter() {
  const [count, setCount] = useState(0);
  const [step, setStep] = useState(1);

  useEffect(() => {
    const id = setInterval(() => {
      setCount((c) => c + step);
    }, 1000);

    return () => clearInterval(id);
  }, [step]);

  return (
    <>
      <h1>{count}</h1>
      <input value={step} onChange={(e) => setStep(Number(e.target.value))} />
    </>
  );
}
```

ë§Œì•½ `step`ì´ ë°”ë€Œë”ë¼ë„ ì¸í„°ë²Œ ì‹œê³„ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šë„ë¡ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´?

```tsx
function Counter({ step }) {
  const [count, dispatch] = useReducer(reducer, 0);

  function reducer(state, action) {
    if (action.type === 'tick') {
      return state + step;
    } else {
      throw new Error();
    }
  }

  useEffect(() => {
    const id = setInterval(() => {
      dispatch({ type: 'tick' });
    }, 1000);

    return () => clearInterval(id);
  }, []);

  return <h1>{count}</h1>;
}
```

ë†€ëê²Œë„ reducer í•¨ìˆ˜ë¥¼ ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ ì •ì˜í•˜ë©´ ê°€ëŠ¥í•˜ë‹¤.

reducer í•¨ìˆ˜ëŠ” ì»´í¬ë„ŒíŠ¸ ë°”ê¹¥ì— ì“°ëŠ” ê²ƒì´ ê´€ë¡€ì´ë‚˜, ì»´í¬ë„ŒíŠ¸ ì•ˆìœ¼ë¡œ ë„£ê³  propì„ ì½ë„ë¡ í•œë‹¤ë©´ ë§¤ë²ˆ `step` propì´ ë°”ë€” ë•Œë§ˆë‹¤ reducerê°€ ì¬ì •ì˜ë˜ê¸° ë•Œë¬¸ì— dispatchê°€ ì•ˆì •ëœ ì‹ë³„ì„±ì„ ê°€ì§„ë‹¤ê³  ë³´ì¥í•  ìˆ˜ ìˆë‹¤.

Q. reducer í•¨ìˆ˜ë¥¼ ì•ˆì—ì„œ ë§Œë“¤ì–´ë„ ë˜ë‚˜? useCallbackì„ ì“°ë©´ ê´œì°®ì„ ê²ƒ ê°™ê¸°ë„.
